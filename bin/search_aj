#!/usr/bin/env python
#coding=UTF-8
## 搜索Java资源，https://github.com/superhj1987/awesome-tech-collections/blob/master/awesome-java.md

import sys
import getopt 
import urllib2

reload(sys) 
sys.setdefaultencoding( "utf-8" )

TIPS_TPL = "\n" + '=' * 8 + "%s" + '=' * 8 + "\n"

def usage():
    print "usage: search_aj [catagory_name | project_name]"

def main():
    opts,args = getopt.getopt(sys.argv[1:],'',[])

    argc = len(args)
    if argc < 1:
        usage()
        sys.exit(1) 

    search_name = args[0]

    print 'searching....'

    search_name = search_name.lower()

    req = urllib2.Request("https://raw.githubusercontent.com/superhj1987/awesome-tech-collections/master/awesome-java.md")
    content = urllib2.urlopen(req).read()

    category = ""
    target_cat = None
    search_result = ""
    lines = content.split("\n")
    for line in lines:
        if line.startswith("##") :
            target_cat = None
            category = line[line.index(" "):].strip().lower()
            if category.find(search_name) > 0:
                search_result +=  TIPS_TPL % ('finded in categoty <' + category + '>')
                target_cat = category
        elif line.startswith("* ["):
            project = line[line.index("["):].strip().lower()
            if target_cat != None:
                search_result += project + "\n"
            elif project.find(search_name) > 0:
                search_result += TIPS_TPL % ('find  matched projects in <' + category + '>') + project + "\n"

    print search_result

if __name__ == "__main__":
    main()